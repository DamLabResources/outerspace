# Configuration file for gRNA extraction with iterative collapse steps.

title = "gRNA Extraction with Iterative Collapse"

# Global patterns that can be used across multiple commands
[[patterns]]
name = "UMI_5prime"
reg_expr = "(?P<UMI_5prime>.{8})(?:CTTGGCTTTATATATCTTGTGG){s<=4}"
read = "R1"
orientation = "forward"
multiple = "first"

[[patterns]]
name = "protospacer"
reg_expr = "(?:TATCTTGTGGAAAGGACGAAACACC){s<=4}(?P<protospacer>.{19,21})(?P<downstreamof_protospacer>GTTTAAGTACTCTGTGCTGGAAACAG){s<=4}"
read = "R1"
orientation = "forward"
multiple = "first"

[[patterns]]
name = "UMI_3prime"
reg_expr = "(?P<UMI_3prime>.{8})(?:TTCCACACCCTAACTGACACAC){s<=4}"
read = "R2"
orientation = "forward"
multiple = "first"

[findseq]
pattern_names = ["UMI_5prime", "protospacer", "UMI_3prime"]
matches_only = true

# Iterative collapse steps
[[collapse.steps]]
name = "umi_correction"
columns = "UMI_5prime,UMI_3prime"
method = "directional"
mismatches = 2

[[collapse.steps]]
name = "protospacer_correction"
columns = "protospacer"
method = "nearest"
allowed_list = "library_protospacers.txt"
mismatch_penalty = -1
gap_penalty = -3
match_score = 1
min_score = 0

[count]
barcode_column = 'UMI_5prime_UMI_3prime_corrected'
key_column = 'protospacer_corrected'

[merge]
column = 'UMI_5prime_UMI_3prime_corrected_count'
key_column = 'protospacer_corrected'

[stats]
key_column = 'protospacer_corrected'
count_column = 'UMI_5prime_UMI_3prime_corrected_count'

[owner]
name = "SCB, DK, WND, RB"
organization = "DUCOM"

